# InverseProbabilityWeighting.R

## setting the working directory
install.packages('rstudioapi')
library("rstudioapi") 
# set working directory
setwd(dirname(getActiveDocumentContext()$path))
## read data
dataframe <- read.table('../muscle-incomplete.txt', header = TRUE)

## Installing packages needed for dataframe manipulation
install.packages('tidyverse')
library(tidyverse)

## Inverse probabilty weighting
# Creating the missing variable (missing=0 if calories is missing)
dataframe = mutate(dataframe, missing = as.numeric(!is.na(dataframe$calories)))

# Calculating the weights (modeling r in function of calhour)
missing_model = glm(data=dataframe, family=binomial, missing~calhour)
dataframe$w = 1/fitted(missing_model)
#!!!! it appears I got some weird values for the weight? can somebody help :o

# Calculating the model for calories in function of calhour
fit_calhour_calories = glm(calories~calhour, data=dataframe, weights=dataframe$w)
summary(fit_calhour_calories)



## KLAAS ALTERNATIVE
## include weight in modeling weights + in final model


dataframe$r<-as.numeric(!is.na(dataframe$calories))
head(dataframe,30)

# Calculating the weights (modeling r in function of calhour)
dataframe.ipw<-glm(r ~ weight  + calhour , data=dataframe,family=binomial)
summary(dataframe.ipw)

## Calculating the weights: Inverse Probabilities

dataframe$w<-1/fitted(dataframe.ipw)
head(dataframe,30)


# Calculating the model for calories in function of calhour
fit_calhour_calories = glm(calories~calhour + weight, data=dataframe, weights=dataframe$w)
summary(fit_calhour_calories)

## KLAAS ALTERNATIVE
## KLAAS ALTERNATIVE
